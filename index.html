
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>여우 콜 피하기 게임</title>
    <style>
        body { margin: 0; overflow: hidden; background: #222; }
        canvas { display: block; margin: 0 auto; background: #444; }
        #game-over, #restart, #score-board { 
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            color: white; font-size: 24px; text-align: center; display: none;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="720" height="1280"></canvas>
    <div id="game-over">
        <div>게임 종료!</div>
        <div id="final-score"></div>
        <input type="text" id="nickname" placeholder="닉네임 입력">
        <button id="submit-score">순위 등록</button>
        <button id="restart">다시하기</button>
    </div>
    <div id="score-board" style="top:10%; left:50%; transform:translateX(-50%);">
        <h3>순위표</h3>
        <ol id="ranking"></ol>
    </div>
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const gameOverDiv = document.getElementById('game-over');
        const finalScoreDiv = document.getElementById('final-score');
        const restartBtn = document.getElementById('restart');
        const submitBtn = document.getElementById('submit-score');
        const nicknameInput = document.getElementById('nickname');
        const rankingList = document.getElementById('ranking');

        let fox = { x: 360, y: 1200, size: 80 };
        let items = [];
        let score = 0, timeLeft = 60, gameSpeed = 2, gameInterval, spawnInterval;
        let running = true;

        function drawFox() {
            ctx.fillStyle = 'orange';
            ctx.beginPath();
            ctx.arc(fox.x, fox.y, fox.size / 2, 0, Math.PI * 2);
            ctx.fill();
        }

        function drawItem(item) {
            ctx.fillStyle = item.color;
            ctx.beginPath();
            ctx.arc(item.x, item.y, item.size / 2, 0, Math.PI * 2);
            ctx.fill();
        }

        function spawnItem() {
            const types = [
                { type: 'poop', color: 'brown', value: -10000 },
                { type: 'honey', color: 'yellow', value: 1000 },
                { type: 'vip', color: 'blue', value: 10000 },
                { type: 'angry', color: 'red', value: -20000 },
                { type: 'tip', color: 'green', value: 2000 }
            ];
            let prob = Math.random();
            let type = prob < 0.8 ? (prob < 0.4 ? types[0] : types[1])
                      : (prob < 0.9 ? types[Math.floor(Math.random() * 2) + 3] : types[2]);
            items.push({ ...type, x: Math.random() * 720, y: -50, size: 60 });
        }

        function updateGame() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawFox();
            items.forEach(item => {
                item.y += gameSpeed;
                drawItem(item);
                if (item.y > fox.y - fox.size && item.y < fox.y + fox.size &&
                    item.x > fox.x - fox.size && item.x < fox.x + fox.size) {
                    score += item.value;
                    item.y = 1300;
                }
            });
        }

        function countdown() {
            timeLeft--;
            if (timeLeft === 50) gameSpeed = 3;
            if (timeLeft === 30) gameSpeed = 4;
            if (timeLeft === 20) gameSpeed = 6;
            if (timeLeft === 10) gameSpeed = 8;
            if (timeLeft <= 0) endGame();
        }

        function endGame() {
            clearInterval(gameInterval);
            clearInterval(spawnInterval);
            gameOverDiv.style.display = 'block';
            finalScoreDiv.textContent = '최종 매출: ' + score + '원';
            loadRanking();
        }

        function restartGame() {
            fox.x = 360;
            items = [];
            score = 0;
            timeLeft = 60;
            gameSpeed = 2;
            running = true;
            gameOverDiv.style.display = 'none';
            startGame();
        }

        function saveRanking(nickname, score) {
            let ranking = JSON.parse(localStorage.getItem('ranking') || '[]');
            ranking.push({ nickname, score });
            ranking.sort((a, b) => b.score - a.score);
            ranking = ranking.slice(0, 10);
            localStorage.setItem('ranking', JSON.stringify(ranking));
        }

        function loadRanking() {
            let ranking = JSON.parse(localStorage.getItem('ranking') || '[]');
            rankingList.innerHTML = '';
            ranking.forEach(entry => {
                const li = document.createElement('li');
                li.textContent = `${entry.nickname}: ${entry.score}원`;
                rankingList.appendChild(li);
            });
        }

        function startGame() {
            gameInterval = setInterval(updateGame, 30);
            spawnInterval = setInterval(spawnItem, 800);
            setInterval(countdown, 1000);
        }

        canvas.addEventListener('touchmove', e => {
            let touch = e.touches[0];
            fox.x = touch.clientX;
        });

        restartBtn.addEventListener('click', restartGame);
        submitBtn.addEventListener('click', () => {
            const nickname = nicknameInput.value.trim() || '익명';
            saveRanking(nickname, score);
            loadRanking();
            nicknameInput.value = '';
        });

        startGame();
    </script>
</body>
</html>
    